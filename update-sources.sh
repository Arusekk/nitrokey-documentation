#!/bin/bash

cd /var/www/docs/sphinx/

echo $(date +%s) >> trigger-log.txt

# Load environment variables from config.env
if [ -f /var/www/docs/sphinx/.env ]; then
  source /var/www/docs/sphinx/.env
else
  echo "Environment file not found!"
  exit 1
fi

git pull

# build container image
bash ./build-container-image.sh

# build locales
bash ./build-locales.sh

# add language files to git (add, commit and push)
git add ./source ./locales --all
git commit -m "Language Files generated by Sphinx"
git push

# weblate pull
bash trigger_weblatepull.sh $WEBLATE_API_KEY

# trigger deepl
bash trigger_deepl.sh $WEBLATE_API_KEY

# weblate commit (deepl-translated files)
bash trigger_weblatecommit.sh $WEBLATE_API_KEY

# weblate push
bash trigger_weblatepush.sh $WEBLATE_API_KEY
